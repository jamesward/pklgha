module pklgha.GitHubActionNode

import "GitHubAction.pkl"

function testSteps(taskString: String(!isEmpty)?, version: String?, cacheDependencyFile: String?, nodeVersionFile: String?): Listing<GitHubAction.Step> = new {
  GitHubAction.stepCheckout
  new {
    uses = "actions/setup-node@v6"
    with {
      ["node-version"] = version
      ["node-version-file"] = nodeVersionFile
      ["cache"] = "npm"
      ["cache-dependency-path"] = cacheDependencyFile ?? "package-lock.json"
    }
  }
  new {
    run = """
      npm ci
      npm \(taskString ?? "test")
      """
  }
}
