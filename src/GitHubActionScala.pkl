module pklgha.GitHubActionScala

import "GitHubAction.pkl"
import "GitHubActionJava.pkl"

function sbtTestSteps(taskString: String(!isEmpty)?, workingDirectory: String?, javaVersion: String?): Listing<GitHubAction.Step> = new {
  GitHubAction.stepCheckout

  GitHubActionJava.setupJava(null, javaVersion, "sbt")

  new {
    uses = "sbt/setup-sbt@v1"
  }

  new {
    run = "sbt \(taskString ?? "test")"
    `working-directory` = workingDirectory
  }
}

function sbtTestJob(taskString: String(!isEmpty)?, workingDirectory: String?, javaVersion: String?): GitHubAction.Job = new {
  `runs-on` = "ubuntu-24.04"
  steps = sbtTestSteps(taskString, workingDirectory, javaVersion)
}
